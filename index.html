<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Photo Enhancer | By Abdul Wahid</title>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        /* --- CSS Styles --- */
        :root {
            --primary: #FF4D5A;
            --primary-hover: #e84118;
            --dark: #222222;
            --light: #F6F7FB;
            --white: #ffffff;
            --shadow: 0 10px 30px rgba(0,0,0,0.08);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Poppins', sans-serif; background-color: var(--light); color: var(--dark); line-height: 1.6; }

        /* Navbar */
        nav { background: var(--white); padding: 15px 5%; box-shadow: 0 2px 10px rgba(0,0,0,0.05); display: flex; justify-content: space-between; align-items: center; }
        .logo { font-size: 24px; font-weight: 700; color: var(--dark); }
        .logo span { color: var(--primary); }
        .developer-badge { font-size: 12px; background: #ffeaa7; padding: 4px 8px; border-radius: 4px; color: #d35400; font-weight: 600; }

        /* Hero Section */
        .hero { text-align: center; padding: 60px 20px; max-width: 800px; margin: 0 auto; }
        .hero h1 { font-size: 2.5rem; margin-bottom: 10px; line-height: 1.2; }
        .hero h1 span { color: var(--primary); }
        .hero p { font-size: 1.1rem; color: #555; margin-bottom: 30px; }
        
        /* Upload Area */
        .upload-box { background: var(--white); padding: 40px; border-radius: 20px; box-shadow: var(--shadow); border: 2px dashed #ddd; transition: 0.3s; position: relative; margin-bottom: 30px; }
        .upload-box:hover { border-color: var(--primary); transform: translateY(-5px); }
        
        input[type="file"] { display: none; }
        .file-label { cursor: pointer; display: block; }
        .icon-large { font-size: 50px; color: var(--primary); margin-bottom: 15px; }
        
        /* Preview Image */
        #preview-container { display: none; margin-top: 20px; }
        #preview-image { max-width: 100%; max-height: 200px; border-radius: 10px; border: 2px solid #eee; }

        /* Button */
        .btn-enhance {
            background: var(--primary); color: white; border: none; padding: 15px 40px; font-size: 18px; font-weight: 600; border-radius: 50px; cursor: pointer; margin-top: 10px; transition: 0.3s; box-shadow: 0 4px 15px rgba(255, 77, 90, 0.4); width: 100%; max-width: 300px;
        }
        .btn-enhance:hover { background: var(--primary-hover); transform: translateY(-2px); }
        .btn-enhance:disabled { background: #ccc; cursor: not-allowed; }

        /* Loader */
        .loader { display: none; margin: 20px auto; border: 4px solid #f3f3f3; border-top: 4px solid var(--primary); border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* --- BEFORE / AFTER SLIDER CSS --- */
        #result-area { display: none; margin-top: 40px; background: white; padding: 20px; border-radius: 15px; box-shadow: var(--shadow); }
        
        .ba-slider {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
            overflow: hidden;
            border-radius: 10px;
            cursor: col-resize;
            border: 2px solid #eee;
        }
        
        .ba-slider img {
            width: 100%;
            display: block;
            height: auto;
        }

        .img-after {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            width: 50%; /* Start at 50% */
            background-size: cover;
            border-right: 3px solid white;
            overflow: hidden;
        }
        
        /* Labels */
        .label { position: absolute; top: 10px; color: white; background: rgba(0,0,0,0.5); padding: 5px 10px; font-size: 12px; border-radius: 4px; pointer-events: none; }
        .label-before { right: 10px; }
        .label-after { left: 10px; z-index: 10; }

        /* Slider Handle Circle */
        .handle {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 40px;
            height: 40px;
            background: white;
            border-radius: 50%;
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
            z-index: 20;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary);
            pointer-events: none; /* Let clicks pass through */
        }

        .download-btn { display: inline-block; margin-top: 20px; text-decoration: none; background: #2ecc71; color: white; padding: 12px 25px; border-radius: 50px; font-weight: 600; box-shadow: 0 4px 10px rgba(46, 204, 113, 0.3); }
        
        /* Footer */
        footer { margin-top: 50px; text-align: center; color: #666; font-size: 14px; padding: 20px; border-top: 1px solid #eee; }
        footer .dev { color: var(--primary); font-weight: bold; }
    </style>
</head>
<body>

    <nav>
        <div class="logo">AI Photo <span>Enhancer</span></div>
        <div class="developer-badge">ABDUL WAHID</div>
    </nav>

    <section class="hero">
        <h1>Make Your Photos <br> <span style="color:var(--primary)">Crystal Clear</span></h1>
        <p>Fix blurry photos & enhance details with AI</p>

        <!-- Upload -->
        <div class="upload-box">
            <label for="fileInput" class="file-label">
                <div class="icon-large"><i class="fas fa-cloud-upload-alt"></i></div>
                <div class="upload-text">Upload Blurry Photo</div>
                <div class="upload-sub">Max size: 4MB</div>
            </label>
            <input type="file" id="fileInput" accept="image/*" onchange="previewPhoto()">
            
            <div id="preview-container">
                <img id="preview-image" src="" alt="Preview">
            </div>
        </div>

        <button id="enhanceBtn" class="btn-enhance" onclick="enhancePhoto()">✨ Enhance Now</button>
        
        <div class="loader" id="loader"></div>
        <p id="loadingText" style="display:none; color:#666; margin-top:10px;">Enhancing... Please wait...</p>

        <!-- RESULT SECTION WITH SLIDER -->
        <div id="result-area">
            <h3 style="margin-bottom:15px; color:#333;">Before / After Comparison</h3>
            
            <div class="ba-slider" id="comparisonSlider">
                <!-- Original Image (Background) -->
                <img id="imgOriginal" src="" alt="Before">
                <span class="label label-before">Before</span>

                <!-- Enhanced Image (Foreground, clipped) -->
                <div class="img-after" id="imgClipped">
                    <img id="imgEnhanced" src="" alt="After">
                    <span class="label label-after">After</span>
                </div>

                <!-- Handle Circle -->
                <div class="handle" id="sliderHandle"><i class="fas fa-arrows-alt-h"></i></div>
            </div>

            <a id="downloadLink" href="#" download="enhanced_wahid.jpg" class="download-btn">
                <i class="fas fa-download"></i> Download HD Image
            </a>
        </div>
    </section>

    <footer>
        <p>&copy; 2025 AI Photo Enhancer</p>
        <p>Developed by <span class="dev">ABDUL WAHID</span></p>
    </footer>

    <script>
        // Preview Function
        function previewPhoto() {
            const fileInput = document.getElementById('fileInput');
            const previewContainer = document.getElementById('preview-container');
            const previewImage = document.getElementById('preview-image');
            const resultArea = document.getElementById('result-area');

            resultArea.style.display = 'none'; // Hide result

            if (fileInput.files && fileInput.files[0]) {
                // Check size 4MB
                if (fileInput.files[0].size > 4 * 1024 * 1024) {
                    alert("⚠️ File is too large! Please use a photo under 4MB.");
                    return;
                }
                const reader = new FileReader();
                reader.onload = function(e) {
                    previewImage.src = e.target.result;
                    previewContainer.style.display = 'block';
                }
                reader.readAsDataURL(fileInput.files[0]);
            }
        }

        // Enhance API Call
        async function enhancePhoto() {
            const fileInput = document.getElementById('fileInput');
            const resultArea = document.getElementById('result-area');
            const loader = document.getElementById('loader');
            const loadingText = document.getElementById('loadingText');
            const btn = document.getElementById('enhanceBtn');

            // Slider Elements
            const imgOriginal = document.getElementById('imgOriginal');
            const imgEnhanced = document.getElementById('imgEnhanced');
            const downloadLink = document.getElementById('downloadLink');

            if (fileInput.files.length === 0) {
                alert("Please select a photo first!");
                return;
            }

            // Start Loading
            loader.style.display = 'block';
            loadingText.style.display = 'block';
            resultArea.style.display = 'none';
            btn.disabled = true;
            btn.innerHTML = "Working magic... ⏳";

            const reader = new FileReader();
            reader.readAsDataURL(fileInput.files[0]);
            
            reader.onload = async function () {
                const base64Image = reader.result;

                try {
                    const response = await fetch('/.netlify/functions/restore', {
                        method: 'POST',
                        body: JSON.stringify({ image: base64Image })
                    });
                    
                    const data = await response.json();
                    
                    if (data.output) {
                        // Setup Slider Images
                        imgOriginal.src = base64Image; // Set Before Image
                        imgEnhanced.src = data.output; // Set After Image
                        downloadLink.href = data.output; // Set Download Link
                        
                        // Show Result
                        resultArea.style.display = 'block';
                        
                        // Initialize Slider Logic
                        initCompare();
                    } else {
                        alert("Error: " + (data.error || "Something went wrong"));
                    }
                } catch (error) {
                    console.error(error);
                    alert("Connection failed. Try a smaller image.");
                } finally {
                    loader.style.display = 'none';
                    loadingText.style.display = 'none';
                    btn.disabled = false;
                    btn.innerHTML = "✨ Enhance Now";
                }
            };
        }

        // SLIDER LOGIC (Drag functionality)
        function initCompare() {
            const slider = document.getElementById('comparisonSlider');
            const clippedDiv = document.getElementById('imgClipped');
            const handle = document.getElementById('sliderHandle');
            
            slider.addEventListener('mousemove', moveSlider);
            slider.addEventListener('touchmove', moveSlider);

            function moveSlider(e) {
                const rect = slider.getBoundingClientRect();
                let x = (e.touches ? e.touches[0].clientX : e.clientX) - rect.left;
                
                // Boundaries
                if (x < 0) x = 0;
                if (x > rect.width) x = rect.width;
                
                // Calculate percentage
                const percent = (x / rect.width) * 100;
                
                // Update CSS
                clippedDiv.style.width = percent + "%";
                handle.style.left = percent + "%";
            }
        }
    </script>
</body>
</html>